#!/usr/bin/env bash

# èŽ·å–æäº¤ä¿¡æ¯æ–‡ä»¶è·¯å¾„
COMMIT_MSG_FILE=$1

# è¯»å–ç¬¬ä¸€è¡Œéžæ³¨é‡Šå†…å®¹
COMMIT_MSG=$(grep -v '^#' "$COMMIT_MSG_FILE" | head -n 1)

# å®šä¹‰ Emoji æ˜ å°„ï¼Œä¸ºäº†æ”¯æŒ declare -A ï¼Œè¯·æŠŠ bash å‡çº§ >= 4.0ï¼Œå¹¶ head -1 .git/hooks/prepare-commit-msg æ£€æŸ¥
declare -A EMOJI_MAP=(
  ["feat"]="âœ¨"
  ["fix"]="ðŸ›"
  ["hotfix"]="ðŸ”¥"
  ["docs"]="ðŸ“š"
  ["style"]="ðŸ’„"
  ["refactor"]="â™»ï¸ "
  ["perf"]="ðŸš€"
  ["optimize"]="ðŸš—"
  ["ux"]="ðŸŽ¨"
  ["chore"]="ðŸ”§"
  ["test"]="ðŸ§ª"
  ["deps"]="ðŸ“¦"
  ["security"]="ðŸ”°"
  ["remove"]="ðŸ—‘ï¸ "
  ["comments"]="ðŸ’¬"
  ["error"]="â›”ï¸"
  ["config"]="âš™ï¸ "
  ["files"]="ðŸ“"
  ["merge"]="ðŸ”€"
  ["revert"]="âªï¸"
  ["init"]="â­ï¸"
  ["i18n"]="ðŸŒ"
  ["log"]="ðŸ“"
  ["cli"]="ðŸ”Œ"
  ["release"]="ðŸ“£"
  ["data"]="ðŸ›¢ï¸"
  ["build"]="ðŸ› ï¸"
)

# æå–æäº¤ç±»åž‹ï¼ˆå¦‚ "feat: xxx" -> "feat"ï¼‰
TYPE=$(echo "$COMMIT_MSG" | grep -oE '^(feat|fix|docs|style|refactor|perf|optimize|ux|chore|test|deps|security|remove|comments|error|config|files|merge|revert|init|i18n|log|ci|release|data|build)\b')

# è°ƒè¯•è¾“å‡ºï¼ˆæäº¤å‰å¯ä»¥æŸ¥çœ‹ï¼‰
# echo "æ£€æµ‹åˆ°æäº¤ç±»åž‹: $TYPE" >&2

# å¦‚æžœåŒ¹é…åˆ°ç±»åž‹ä¸”æœªæ‰‹åŠ¨æ·»åŠ  Emojiï¼Œåˆ™è‡ªåŠ¨æ’å…¥
if [[ -n "$TYPE" ]] && ! grep -qE '^[âœ¨ðŸ›ðŸ”¥ðŸ“šðŸ’„â™»ï¸ðŸš€ðŸš—ðŸŽ¨ðŸ”§ðŸ§ªðŸ“¦ðŸ”°ðŸ—‘ï¸ðŸ’¬â›”ï¸âš™ï¸ðŸ“ðŸ”€âªï¸â­ï¸ðŸŒðŸ“ðŸ”ŒðŸ“£ðŸ›¢ï¸ðŸ› ï¸]' "$COMMIT_MSG_FILE"; then
  EMOJI=${EMOJI_MAP[$TYPE]}
  # åœ¨é¦–è¡Œæ’å…¥ Emoji
  echo "${EMOJI} ${COMMIT_MSG}" > "$COMMIT_MSG_FILE"
fi

exit 0
