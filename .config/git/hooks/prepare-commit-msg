#!/usr/bin/env bash

# èŽ·å–æäº¤ä¿¡æ¯æ–‡ä»¶è·¯å¾„
COMMIT_MSG_FILE=$1

# è¯»å–ç¬¬ä¸€è¡Œéžæ³¨é‡Šå†…å®¹
COMMIT_MSG=$(grep -v '^#' "$COMMIT_MSG_FILE" | head -n 1)

# å®šä¹‰ Emoji æ˜ å°„ï¼Œä¸ºäº†æ”¯æŒ declare -A ï¼Œè¯·æŠŠ bash å‡çº§ >= 4.0ï¼Œå¹¶ head -1 .git/hooks/prepare-commit-msg æ£€æŸ¥
declare -A EMOJI_MAP=(
  ["feat"]="âœ¨"
  ["fix"]="ðŸ›"
  ["docs"]="ðŸ“"
  ["style"]="ðŸŽ¨"
  ["refactor"]="ðŸ”§"
  ["test"]="âœ…"
  ["perf"]="ðŸš€"
  ["chore"]="ðŸ”¨"
)

# æå–æäº¤ç±»åž‹ï¼ˆå¦‚ "feat: xxx" -> "feat"ï¼‰
TYPE=$(echo "$COMMIT_MSG" | grep -oE '^(feat|fix|docs|style|refactor|test|perf|chore)\b')

# è°ƒè¯•è¾“å‡ºï¼ˆæäº¤å‰å¯ä»¥æŸ¥çœ‹ï¼‰
echo "æ£€æµ‹åˆ°æäº¤ç±»åž‹: $TYPE" >&2

# å¦‚æžœåŒ¹é…åˆ°ç±»åž‹ä¸”æœªæ‰‹åŠ¨æ·»åŠ  Emojiï¼Œåˆ™è‡ªåŠ¨æ’å…¥
if [[ -n "$TYPE" ]] && ! grep -qE '^[ðŸŽ¨ðŸ›âœ¨ðŸ“ðŸ”§âœ…ðŸš€ðŸ”¨]' "$COMMIT_MSG_FILE"; then
  EMOJI=${EMOJI_MAP[$TYPE]}
  # åœ¨é¦–è¡Œæ’å…¥ Emoji
  echo "${EMOJI} ${COMMIT_MSG}" > "$COMMIT_MSG_FILE"
fi

exit 0
